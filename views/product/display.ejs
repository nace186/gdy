<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title><%= __('Update') %> <%= __('Product') %></title>
    <% include ../partials/header %>
  </head>
  
  <body>
    <div id="wrapper">
      <%- include("../partials/nav",{title: __('Update') + ' ' + __('Product')}) %>

      <div id="page-wrapper" style="padding-top: 5px;">
        <div class="row">
          <div class="col-lg-12">
            <div class="panel panel-default">
              <div class="panel-heading">
                
              </div>
              <!-- /.panel-heading -->
              <div class="panel-body">
                
                <table class="table table-striped table-bordered table-hover" id="productTable">
                  <thead>
                    <tr>
                      <th><%= __('Code') %> </th>
                      <th><%= __('Name') %> </th>
                      <th><%= __('Unit') %> / <%= __('Exchange') %></th>
                      <th><%= __('Type') %> </th>
                      <th><%= __('Manufacturer') %> </th>
                      <th><%= __('HCM') %> </th>
                      <th><%= __('LongAn') %></th>
                      <th style="width:40px;"><%= __('Last Update') %></th>
                      <th><%= __('Action') %></th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
                
              </div>
              
              <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
            
          </div>
          <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
          <div class="col-lg-12">
            <div class="panel panel-default">
              <div class="panel-body">
                <h2><%= __('Add') %> <%= __('Product') %></h2>
                <!-- add new manu -->
                
                <form role="form" action="/product/add" method="post">
                  <table class="table table-hover" id="productTable">
                    <tr>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Code') %> :</label>
                          <input class="form-control" placeholder="<%= __('Code') %>" name="code" type="text" autofocus>
                        </div>
                      </td>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Name') %> :</label>
                          <input class="form-control" placeholder="<%= __('Name') %>" name="name" type="text" autofocus>
                        </div>
                      </td>
                      <td>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Type') %> :</label>
                          <select class="form-control" name="type">
                            <% for ( var i = 0; i < type.length; i++ ) { %>
                            <option value="<%= type[i].code %>">
                              <% if (user.lang == 'en') { %>
                              <%=type[i].nameEn %>
                              <% } %>
                              <% if (user.lang == 'cn') { %>
                              <%=type[i].nameCn %>
                              <% } %>
                              <% if (user.lang == 'vn') { %>
                              <%=type[i].nameVn %>
                              <% } %>
                            </option>
                            <% } %>
                          </select>
                        </div>
                      </td>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Manufacturer') %> :</label>
                          <select class="form-control" name="manu">
                            <% for ( var i = 0; i < manu.length; i++ ) { %>
                            <option value="<%= manu[i].code %>"> <%=manu[i].name %> </option>
                            <% } %>
                          </select>
                        </div>
                      </td>
                      <td>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Unit1') %> :</label>
                          <input class="form-control" placeholder="<%= __('Unit1') %>" name="unit1" type="text" autofocus >
                        </div>
                      </td>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Unit2') %> :</label>
                          <input class="form-control" placeholder="<%= __('Unit2') %>" name="unit2" type="text" autofocus>
                        </div>
                      </td>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('Exchange') %> :</label>
                          <input class="form-control" placeholder="<%= __('Exchange') %>" name="exchange" value="0" type="number" step="0.01" >
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('HMC') %> :</label>
                          <input class="form-control" placeholder="<%= __('HMC') %>" name="hmc" value="0" type="number" step="0.01" >
                        </div>
                      </td>
                      <td>
                        <div class="form-group form-inline">
                          <label><%= __('LongAn') %> :</label>
                          <input class="form-control" placeholder="<%= __('LongAn') %>" name="longAn" value="0" type="number" step="0.01" >
                        </div>
                      </td>
                      <td>
                        <input type="submit" class="btn btn-lg btn-success btn-block" value="<%= __('Add') %> <%= __('Product') %>"/>
                      </td>
                    </tr>
                  </table>
                  
                </form>
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel"><%= __('Error') %></h4>
                      </div>
                      <div class="modal-body" id="modalMsg">
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default " data-dismiss="modal">OK</button>
                      </div>
                    </div>
                    <!-- /.modal-content -->
                  </div>
                  <!-- /.modal-dialog -->
                </div>
                
              </div>
            </div>
          </div>
        </div>
        <!-- /.row -->
      </div>
      <!-- /#page-wrapper -->
    </div>
    <!-- /#wrapper -->
    
    <% include ../partials/js %>
    <script>
    /*
    <th><%= __('Code') %> </th>
    <th><%= __('Name') %> </th>
    <th><%= __('Unit1') %> </th>
    <th><%= __('Unit2') %> </th>
    <th><%= __('Exchange') %> </th>
    <th><%= __('Type') %> </th>
    <th><%= __('Manufacturer') %> </th>
    <th><%= __('HMC') %> </th>
    <th><%= __('LongAn') %></th>
    <th><%= __('Last Update') %></th>
    <th><%= __('Modify') %></th>
    <th><%= __('Delete') %></th>
    SELECT Manufacturer.name AS manuName, Manufacturer.code AS manuCode,\
    Products.name AS productName, Products.code AS productCode, Products.id AS productId,\
    ProductType.code AS typeCode, * FROM Products\
    LEFT JOIN Manufacturer ON Products.manufacturer = Manufacturer.code\
    LEFT JOIN ProductType ON Products.type = ProductType.code'
    */
      $(document).ready(function () 
      {
          //query to populate the table
        $('#productTable').DataTable({
            <% include ../partials/datatables_lang %>,
            "ajax": {
              "url": '/product/getProducts',
              "dataSrc": function (json) {
                return json;
              }
            },
            bAutoWidth: false ,
            columns: [
            { data: 'productCode' },
            { data: 'productName' },
            {
              "targets": -1,
              "render": function ( data, type, full, meta ) {
                data2 = full.unit2 + " / " + full.exchange + " " + full.unit1;
                return data2;
              }
            },
            <% if (user.lang == 'en') { %>
            { data: 'nameEn'},
            <% } %>
            <% if (user.lang == 'cn') { %>
            { data: 'nameCn'},
            <% } %>
            <% if (user.lang == 'vn') { %>
            { data: 'nameVn'},
            <% } %>
            { data: 'manuName' },
            {data: 'hmc'},
            { data: 'longAn'},
            {
              "targets": -1,
              "render": function ( data, type, full, meta ) {
                var data2 = '<a href="#" data-toggle="tooltip" title="'+full.lastUpdate+'">Hover</a>';
                return data2;
              }
            },
            {
              "targets": -1,
              "render": function ( data, type, full, meta ) {

                data3 = '<div class="btn-group">\
                              <button type="button" class="btn btn-primary btn-xs dropdown-toggle" data-toggle="dropdown"><%= __("Action") %>\
                              <span class="caret"></span></button>\
                              <ul class="dropdown-menu" role="menu" style="min-width:90px">\
                                <li><a href="/product/updateInventory/'+ full.productId +'" id="update_button" class="updateButton"><%= __("Update") %> <%= __("Inventory") %></a></li>\
                                <li><a href="/product/update/'+ full.productId +'" id="modify_button" class="modifyButton"><%= __("Modify") %></a></li>\
                                <li><a href="#" class="deleteButton" id="'+ full.productId +'"><%= __("Delete") %></a></li>\
                              </ul>\
                          </div>';
                return data3;
              }
            },        
          ]
        });
      });
      
      $('#productTable').on('draw.dt', function () {
        $('[data-toggle="tooltip"]').tooltip();
      });
    
      $('#productTable').on('click', '.deleteButton', function()
      {
        val = $(this).attr('id');
        //handler for the delete button
        if (confirm("Are you sure you want to delete this?"))
        {
          $.ajax({
            "type": "DELETE",
            "url": '/product/delete/'+val,
            "success": function () {
              location.reload(true);
            },
            "error": function (jqXHR, textStatus, errorThrown) {
              $("#modalMsg").text("Unable to delete, contact admin");
              $("#myModal").modal();
            }
          });
        } // if
      }); // table on
    </script>
  </body>
</html>